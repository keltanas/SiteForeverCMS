#assetic:
#    debug: %debug%
#    output: "%root%/static"
#    assets:
#        site_js:
#            output: "static/site.js"
#            input:
#                - "%sfcms.path%/misc/site.js"

services:
    # assetic
    asset.manager:
        class: Assetic\AssetManager

    asset.filter.manager:
        class: Assetic\FilterManager

    asset.cache_boosting.worker:
        class: Assetic\Factory\Worker\CacheBustingWorker

    asset.factory:
        class: Assetic\Factory\AssetFactory
        arguments: ["%assetic.output%"]
        calls:
            - [setAssetManager, [@asset.manager]]
            - [setFilterManager, [@asset.filter.manager]]
            - [setDebug, [%debug%]]
#            - [addWorker, [@asset.cache_boosting.worker]]

    asset.writer.listener:
        class: Module\System\Subscriber\AssetWriteListener
        arguments: ["@asset.manager", "%assetic.output%"]
        tags:
            - { name: event.listener, event: kernel.terminate, method: writeAllAssets }

    asset.service:
        class: Module\System\Service\AsseticService
        arguments: ["@asset.factory", "@service_container", "%assetic.output%"]

    smarty.plugin.asset:
        class: Module\System\Plugin\AssetPlugin
        arguments: ["@asset.factory", "%sfcms.cache_dir%/assetic"]
        tags:
            - { name: smarty.plugin, type: function, plugin: style, method: functionStyle }
            - { name: smarty.plugin, type: function, plugin: js, method: functionJs }
